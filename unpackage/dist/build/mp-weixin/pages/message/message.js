(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/message/message"],{"09df":function(e,t,s){},2670:function(e,t,s){"use strict";var n=function(){var e=this,t=e.$createElement;e._self._c},a=[];s.d(t,"a",function(){return n}),s.d(t,"b",function(){return a})},"580a":function(e,t,s){"use strict";var n=s("09df"),a=s.n(n);a.a},"5e66":function(e,t,s){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s("98fb"));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(){return s.e("components/uni-popup/uni-popup").then(s.bind(null,"d187"))},i=function(){return s.e("components/uni-list/uni-list").then(s.bind(null,"8c6a"))},u=function(){return s.e("components/uni-list-item/uni-list-item").then(s.bind(null,"c046"))};function r(t){var s=1;t.message_list=[];for(var a=1;a<=s;a++)e.request({url:n.default+"/message?to_user_id="+t.user_id+"&status=unread&page="+a,header:{Authorization:"Bearer "+t.token},method:"GET",success:function(n){console.log(n),200==n.statusCode?0!=n.data.total?(s=Math.ceil(n.data.total/n.data.per_page),t.message_list.push.apply(t.message_list,n.data.data)):(e.showToast({title:"无未读信息",icon:"none",duration:2e3}),console.log("无未读信息")):204==n.statusCode?console.log("无系统通知信息"):console.log("系统通知信息获取失败")}})}var l={components:{uniPopup:o,uniList:i,uniListItem:u},data:function(){return{userName:"",token:"",user_id:0,isShowPopup:!1,message_content:"",message_title:"",message_from:"",message_list:[{id:1,from:{id:1,name:"test"},to:{id:2,name:"test2"},title:"test title",status:"unread"},{id:1,from:{id:1,name:"test3"},to:{id:2,name:"test4"},title:"test title2",status:"unread"},{id:1,from:{id:1,name:"test"},to:{id:2,name:"test2"},title:"test title",status:"unread"}]}},onLoad:function(){this.token=e.getStorageSync("token"),this.userName=e.getStorageSync("userName"),this.user_id=e.getStorageSync("user_id");var t=this;r(t)},onPullDownRefresh:function(){console.log("refresh");var t=this;r(t),setTimeout(function(){e.stopPullDownRefresh()},1e3)},methods:{showMessage:function(t){var s=this;console.log(t);var a=t.currentTarget.dataset.one,o=t.currentTarget.dataset.two;e.request({url:n.default+"/message/"+a,method:"GET",header:{Authorization:"Bearer "+this.token},success:function(n){if(200==n.statusCode){if(s.message_title=n.data.data.title,s.message_from=n.data.data.from.name,s.message_content=n.data.data.content,s.message_list.splice(o,1),0==s.message_list.length)try{e.setStorageSync("start_query_unread_message",!0)}catch(t){console.log("存储出现问题")}}else e.showToast({icon:"none",title:"获取消息失败",duration:2e3})},fail:function(){console.log(查询失败)}}),this.isShowPopup=!0},closeMessage:function(){this.isShowPopup=!1},clearAll:function(){var t=this;0!=this.message_list.length?e.showModal({title:"提示",content:"是否确定清除",success:function(s){if(s.confirm){console.log("用户点击确定");for(var a=0;a<t.message_list.length;a++)e.request({url:n.default+"/message/"+t.message_list[a].id,method:"GET",header:{Authorization:"Bearer "+t.token}});t.message_list=[];try{e.setStorageSync("start_query_unread_message",!0)}catch(o){console.log("存储出现问题")}e.showToast({title:"清除成功",duration:2e3})}else console.log("用户点击取消")}}):e.showToast({duration:2e3,title:"消息已为空"})},goMessageRead:function(){e.navigateTo({url:"message_read/message_read"})}}};t.default=l}).call(this,s("543d")["default"])},8184:function(e,t,s){"use strict";s.r(t);var n=s("5e66"),a=s.n(n);for(var o in n)"default"!==o&&function(e){s.d(t,e,function(){return n[e]})}(o);t["default"]=a.a},aa0d:function(e,t,s){"use strict";s.r(t);var n=s("2670"),a=s("8184");for(var o in a)"default"!==o&&function(e){s.d(t,e,function(){return a[e]})}(o);s("580a");var i=s("2877"),u=Object(i["a"])(a["default"],n["a"],n["b"],!1,null,null,null);t["default"]=u.exports}},[["b69d","common/runtime","common/vendor"]]]);